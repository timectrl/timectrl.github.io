# Generated by Anaconda 34.24.9
# Generated by pykickstart v3.32
#version=DEVEL
# Use graphical install
graphical

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Use network installation
url --url="http://mirrors.163.com/fedora/releases/34/Everything/x86_64/os"

%packages
#@^workstation-product-environment
@^minimal-environment

%end

# SELinux configuration
selinux --disabled

# Run the Setup Agent on first boot
firstboot --enable
# Do not configure the X Window System
skipx

# Generated using Blivet version 3.3.3
ignoredisk --only-use=vda
# Partition clearing information
clearpart --none --initlabel
# Disk partitioning information
#part / --fstype="xfs"
#part /boot/efi --fstype="efi" --ondisk=vda --size=128   --fsoptions="umask=0077,shortname=winnt"
#part /         --fstype="xfs" --ondisk=vda --size=10240 --grow

# System timezone
timezone Asia/Shanghai

#Root password
rootpw --lock
user --groups=wheel --name=zhangquan --password=$6$knMxMxQswPp4m0ey$d2a5bx0jdg.xyLNZq8umq8jkiMBmVVmS.13wljTeUdmM9U7JXtW/MEjUrMFnRwmJ8Z2q36WrNMU2m4ZgI8/7z1 --iscrypted --gecos="ZhangQuan"

#%post --log=/root/init.log
%post
dnf -y install wget

mkdir -p /root/.ssh
wget -O /root/.ssh/authorized_keys http://www.timectrl.net/files/authorized_keys
chmod 700 /root/.ssh
chmod 600 /root/.ssh/authorized_keys
passwd -l root

mkdir -p /home/zhangquan/.ssh
wget -O /home/zhangquan/.ssh/authorized_keys http://www.timectrl.net/files/authorized_keys
chown -R zhangquan:zhangquan /home/zhangquan/
chmod 700 /home/zhangquan/.ssh
chmod 600 /home/zhangquan/.ssh/authorized_keys
passwd -l zhangquan

echo 'zhangquan ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/zhangquan-root
#echo '%wheel ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers.d/zhangquan-root

systemctl disable firewalld.service
systemctl disable dnf-makecache.timer

dnf -y remove PackageKit-command-not-found PackageKit-gtk3-module gnome-boxes abrt* nano-default-editor


dnf -y update --exclude 'kernel-*'
dnf -y install vim vim-default-editor screen tcpdump mtr rsync bash-completion openssl


echo "alias vi='vim'" >>/root/.bashrc



touch /etc/rc.d/rc.local
chmod +x /etc/rc.d/rc.local
ln -s /etc/rc.d/rc.local /etc/rc.local
echo "#!/bin/bash" >>/etc/rc.d/rc.local
echo -e "\n\n\n\n\n\n\n\n\n\n\n\n\n" >>/etc/rc.d/rc.local
echo "exit 0" >>/etc/rc.d/rc.local
echo -e "\n\n" >>/etc/rc.d/rc.local



dnf -y install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm


#dnf -y install http://static.jikedata.com/rpm/proton.rpm

#rm -fr /root/original-ks.cfg /root/anaconda-ks.cfg /root/init.log
%end


# Reboot after installation
reboot

